-- DragonHub Minimal UI Library (ModuleScript)
-- Purpose: Very small UI library with:
--   - set UI name / subtitle
--   - change open/close icon images
--   - change window image (background image for the UI)
--   - add Toggle, Slider, Button controls to a single content page
--   - simple state storage accessible with :GetValue(key)
--
-- Usage:
--   local DragonHub = require(path.to.DragonHub)
--   local hub = DragonHub.new({ Title = "My UI", Subtitle = "by Me" })
--   hub:SetIconImages("rbxassetid://OPEN", "rbxassetid://CLOSED")
--   hub:SetWindowImage("rbxassetid://WINDOW_BG")
--   hub:CreateToggle("God Mode", "god", function(enabled) print(enabled) end)
--   hub:CreateSlider("Speed", "speed", 10, 100, function(value) print(value) end)
--   hub:CreateButton("Do Thing", true, function() print("clicked") end)
--   print(hub:GetValue("speed"))
--
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")
local Players = game:GetService("Players")

local DragonHub = {}
DragonHub.__index = DragonHub

local function tween(obj, props, t, style)
    TweenService:Create(obj, TweenInfo.new(t or 0.25, style or Enum.EasingStyle.Quad, Enum.EasingDirection.Out), props):Play()
end

local function createCorner(parent, radius)
    local c = Instance.new("UICorner")
    c.CornerRadius = UDim.new(0, radius or 10)
    c.Parent = parent
    return c
end

local function createStroke(parent, color, thickness)
    local s = Instance.new("UIStroke")
    s.Color = color or Color3.fromRGB(0,0,0)
    s.Thickness = thickness or 1
    s.Parent = parent
    return s
end

-- Constructor
-- opts: { Title = string, Subtitle = string, Width = number, Height = number }
function DragonHub.new(opts)
    opts = opts or {}
    local self = setmetatable({}, DragonHub)

    self.titleText = opts.Title or "Dragon UI"
    self.subtitleText = opts.Subtitle or ""
    self.width = opts.Width or 520
    self.height = opts.Height or 320

    -- minimal state storage for toggles/sliders
    self.state = {}

    -- UI refs (exposed)
    self.gui = nil
    self.iconBtn = nil
    self.mainFrame = nil
    self.header = nil
    self.content = nil
    self._windowImage = nil

    self._openImage = nil
    self._closedImage = nil

    self:_buildGui()
    return self
end

function DragonHub:_buildGui()
    local COLORS = {
        Primary = Color3.fromRGB(25,25,25),
        Background = Color3.fromRGB(255,255,255),
        Secondary = Color3.fromRGB(245,245,245),
        Text = Color3.fromRGB(20,20,20),
        TextDim = Color3.fromRGB(120,120,120)
    }

    local gui = Instance.new("ScreenGui")
    gui.Name = "DragonHubMinimal_" .. math.random(1000,9999)
    gui.ResetOnSpawn = false
    gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    gui.Parent = game.CoreGui
    self.gui = gui

    -- Icon container (draggable)
    local iconContainer = Instance.new("Frame", gui)
    iconContainer.Size = UDim2.new(0, 60, 0, 60)
    iconContainer.Position = UDim2.new(0, 20, 0, 20)
    iconContainer.BackgroundTransparency = 1
    iconContainer.Active = true
    iconContainer.Draggable = true

    local iconBtn = Instance.new("ImageButton", iconContainer)
    iconBtn.Size = UDim2.new(1,0,1,0)
    iconBtn.BackgroundColor3 = COLORS.Background
    iconBtn.BorderSizePixel = 0
    iconBtn.AutoButtonColor = false
    iconBtn.Image = "" -- set via SetIconImages
    createCorner(iconBtn, 14)
    createStroke(iconBtn, COLORS.Primary, 2)
    self.iconBtn = iconBtn

    -- Main frame
    local mainFrame = Instance.new("Frame", gui)
    mainFrame.Size = UDim2.new(0, self.width, 0, self.height)
    mainFrame.Position = UDim2.new(0.5, -self.width/2, 0.5, -self.height/2)
    mainFrame.BackgroundColor3 = COLORS.Background
    mainFrame.BorderSizePixel = 0
    mainFrame.Visible = false
    mainFrame.ClipsDescendants = true
    mainFrame.Active = true
    mainFrame.Draggable = true
    createCorner(mainFrame, 14)
    createStroke(mainFrame, COLORS.Primary, 2)
    self.mainFrame = mainFrame

    -- Optional window image (behind content)
    local windowImage = Instance.new("ImageLabel", mainFrame)
    windowImage.Name = "WindowImage"
    windowImage.Size = UDim2.new(1,0,1,0)
    windowImage.Position = UDim2.new(0,0,0,0)
    windowImage.BackgroundTransparency = 1
    windowImage.Image = ""
    windowImage.ZIndex = 1
    self._windowImage = windowImage

    -- Header
    local header = Instance.new("Frame", mainFrame)
    header.Size = UDim2.new(1,0,0,56)
    header.Position = UDim2.new(0,0,0,0)
    header.BackgroundColor3 = COLORS.Primary
    header.BorderSizePixel = 0
    header.ZIndex = 2
    createCorner(header, 14)
    self.header = header

    local title = Instance.new("TextLabel", header)
    title.Size = UDim2.new(1,-120,0,28)
    title.Position = UDim2.new(0,12,0,6)
    title.BackgroundTransparency = 1
    title.Text = self.titleText
    title.TextColor3 = COLORS.Background
    title.Font = Enum.Font.GothamBold
    title.TextSize = 18
    title.TextXAlignment = Enum.TextXAlignment.Left
    self._titleLabel = title

    local subtitle = Instance.new("TextLabel", header)
    subtitle.Size = UDim2.new(1,-120,0,18)
    subtitle.Position = UDim2.new(0,12,0,30)
    subtitle.BackgroundTransparency = 1
    subtitle.Text = self.subtitleText
    subtitle.TextColor3 = Color3.fromRGB(200,200,200)
    subtitle.Font = Enum.Font.Gotham
    subtitle.TextSize = 11
    subtitle.TextXAlignment = Enum.TextXAlignment.Left
    self._subtitleLabel = subtitle

    local closeBtn = Instance.new("TextButton", header)
    closeBtn.Size = UDim2.new(0,32,0,32)
    closeBtn.Position = UDim2.new(1,-44,0.5,-16)
    closeBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
    closeBtn.BorderSizePixel = 0
    closeBtn.Text = "X"
    closeBtn.TextColor3 = Color3.fromRGB(255,255,255)
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.TextSize = 14
    closeBtn.AutoButtonColor = false
    closeBtn.ZIndex = 4
    createCorner(closeBtn, 8)
    closeBtn.MouseButton1Click:Connect(function()
        tween(mainFrame, {Size = UDim2.new(0,0,0,0), Position = UDim2.new(0.5,0,0.5,0)}, 0.25)
        task.wait(0.25)
        mainFrame.Visible = false
        if self._closedImage then self.iconBtn.Image = self._closedImage end
    end)

    -- Content area (single page)
    local content = Instance.new("ScrollingFrame", mainFrame)
    content.Size = UDim2.new(1,-24,1,-76)
    content.Position = UDim2.new(0,12,0,64)
    content.BackgroundTransparency = 1
    content.BorderSizePixel = 0
    content.ScrollBarThickness = 6
    content.CanvasSize = UDim2.new(0,0,0,0)
    content.AutomaticCanvasSize = Enum.AutomaticSize.Y
    content.VerticalScrollBarInset = Enum.ScrollBarInset.ScrollBar
    content.ZIndex = 3
    self.content = content

    -- Icon button toggles mainFrame visibility and swaps images
    self.iconBtn.MouseButton1Click:Connect(function()
        if mainFrame.Visible then
            tween(mainFrame, {Size = UDim2.new(0,0,0,0), Position = UDim2.new(0.5,0,0.5,0)}, 0.25)
            task.wait(0.25)
            mainFrame.Visible = false
            if self._closedImage then self.iconBtn.Image = self._closedImage end
        else
            mainFrame.Size = UDim2.new(0,0,0,0)
            mainFrame.Position = UDim2.new(0.5,0,0.5,0)
            mainFrame.Visible = true
            tween(mainFrame, {Size = UDim2.new(0,self.width,0,self.height), Position = UDim2.new(0.5,-self.width/2,0.5,-self.height/2)}, 0.35)
            if self._openImage then self.iconBtn.Image = self._openImage end
        end
    end)

    -- keep layout placement index
    self._nextY = 8
end

-- Set images for open and closed icon states
function DragonHub:SetIconImages(openImage, closedImage)
    self._openImage = openImage or ""
    self._closedImage = closedImage or ""
    -- set current icon to closed by default
    self.iconBtn.Image = self.mainFrame.Visible and (self._openImage or "") or (self._closedImage or "")
end

-- Set the window/background image (covers the whole main window behind UI)
function DragonHub:SetWindowImage(imageId)
    if self._windowImage then
        self._windowImage.Image = imageId or ""
    end
end

-- Set the UI title shown in the header
function DragonHub:SetTitle(text)
    self.titleText = text or ""
    if self._titleLabel then self._titleLabel.Text = self.titleText end
end

-- Set the UI subtitle shown in the header
function DragonHub:SetSubtitle(text)
    self.subtitleText = text or ""
    if self._subtitleLabel then self._subtitleLabel.Text = self.subtitleText end
end

-- Get stored value (for toggles/sliders)
function DragonHub:GetValue(key)
    return self.state[key]
end

-- Internal helper to reserve vertical space in content
function DragonHub:_reserve(height)
    local y = self._nextY
    self._nextY = self._nextY + height + 10
    return y
end

-- Create a Toggle
-- labelText: shown label
-- key: string key to store value in hub.state
-- callback(enabled) called on change
function DragonHub:CreateToggle(labelText, key, callback)
    local y = self:_reserve(42)
    local parent = self.content

    local container = Instance.new("Frame", parent)
    container.Size = UDim2.new(1, -20, 0, 42)
    container.Position = UDim2.new(0, 10, 0, y)
    container.BackgroundColor3 = Color3.fromRGB(250,250,250)
    container.BorderSizePixel = 0
    createCorner(container, 8)

    local label = Instance.new("TextLabel", container)
    label.Size = UDim2.new(1, -90, 1, 0)
    label.Position = UDim2.new(0, 12, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = labelText or "Toggle"
    label.TextColor3 = Color3.fromRGB(25,25,25)
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left

    local toggleBg = Instance.new("TextButton", container)
    toggleBg.Size = UDim2.new(0, 50, 0, 26)
    toggleBg.Position = UDim2.new(1, -66, 0.5, -13)
    toggleBg.BackgroundColor3 = Color3.fromRGB(200,200,200)
    toggleBg.BorderSizePixel = 0
    toggleBg.AutoButtonColor = false
    createCorner(toggleBg, 13)

    local knob = Instance.new("Frame", toggleBg)
    knob.Size = UDim2.new(0, 20, 0, 20)
    knob.Position = UDim2.new(0, 3, 0.5, -10)
    knob.BackgroundColor3 = Color3.fromRGB(255,255,255)
    knob.BorderSizePixel = 0
    createCorner(knob, 10)

    -- initial state = false
    self.state[key] = false

    toggleBg.MouseButton1Click:Connect(function()
        self.state[key] = not self.state[key]
        local on = self.state[key]
        tween(knob, {Position = on and UDim2.new(1, -23, 0.5, -10) or UDim2.new(0, 3, 0.5, -10)}, 0.18)
        tween(toggleBg, {BackgroundColor3 = on and Color3.fromRGB(40,40,40) or Color3.fromRGB(200,200,200)}, 0.18)
        if callback then pcall(callback, on) end
    end)

    return container
end

-- Create a Slider
-- labelText, key, min, max, callback(value)
function DragonHub:CreateSlider(labelText, key, min, max, callback)
    min = min or 0
    max = max or 100
    local y = self:_reserve(60)
    local parent = self.content

    local container = Instance.new("Frame", parent)
    container.Size = UDim2.new(1, -20, 0, 60)
    container.Position = UDim2.new(0, 10, 0, y)
    container.BackgroundColor3 = Color3.fromRGB(250,250,250)
    container.BorderSizePixel = 0
    createCorner(container, 8)

    local label = Instance.new("TextLabel", container)
    label.Size = UDim2.new(1, -16, 0, 22)
    label.Position = UDim2.new(0, 12, 0, 6)
    label.BackgroundTransparency = 1
    label.Text = (labelText or "Slider") .. ": " .. tostring(min)
    label.TextColor3 = Color3.fromRGB(25,25,25)
    label.Font = Enum.Font.Gotham
    label.TextSize = 13
    label.TextXAlignment = Enum.TextXAlignment.Left

    local sliderBg = Instance.new("Frame", container)
    sliderBg.Size = UDim2.new(1, -24, 0, 8)
    sliderBg.Position = UDim2.new(0, 12, 0, 40)
    sliderBg.BackgroundColor3 = Color3.fromRGB(220,220,220)
    sliderBg.BorderSizePixel = 0
    createCorner(sliderBg, 4)

    local fill = Instance.new("Frame", sliderBg)
    fill.Size = UDim2.new(0, 0, 1, 0)
    fill.BackgroundColor3 = Color3.fromRGB(25,25,25)
    fill.BorderSizePixel = 0
    createCorner(fill, 4)

    local knob = Instance.new("Frame", sliderBg)
    knob.Size = UDim2.new(0, 18, 0, 18)
    knob.Position = UDim2.new(0, -9, 0.5, -9)
    knob.BackgroundColor3 = Color3.fromRGB(255,255,255)
    knob.BorderSizePixel = 0
    createCorner(knob, 9)

    -- initial value = min
    self.state[key] = min
    label.Text = (labelText or "Slider") .. ": " .. tostring(self.state[key])

    local dragging = false
    local function update(input)
        local absPos = sliderBg.AbsolutePosition.X
        local absSize = sliderBg.AbsoluteSize.X
        local x = math.clamp((input.Position.X - absPos) / absSize, 0, 1)
        local value = math.floor(min + (max - min) * x)
        self.state[key] = value
        label.Text = (labelText or "Slider") .. ": " .. tostring(value)
        fill.Size = UDim2.new(x, 0, 1, 0)
        knob.Position = UDim2.new(x, -9, 0.5, -9)
        if callback then pcall(callback, value) end
    end

    knob.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
        end
    end)
    knob.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)
    sliderBg.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            update(input)
        end
    end)
    sliderBg.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            update(input)
        end
    end)

    return container
end

-- Create a Button
-- text, primary(bool), callback()
function DragonHub:CreateButton(text, primary, callback)
    local y = self:_reserve(42)
    local parent = self.content

    local btn = Instance.new("TextButton", parent)
    btn.Size = UDim2.new(1, -20, 0, 42)
    btn.Position = UDim2.new(0, 10, 0, y)
    btn.BackgroundColor3 = primary and Color3.fromRGB(25,25,25) or Color3.fromRGB(240,240,240)
    btn.TextColor3 = primary and Color3.fromRGB(255,255,255) or Color3.fromRGB(30,30,30)
    btn.Text = text or "Button"
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 14
    btn.BorderSizePixel = 0
    btn.AutoButtonColor = false
    createCorner(btn, 8)

    btn.MouseEnter:Connect(function() tween(btn, {BackgroundColor3 = primary and Color3.fromRGB(45,45,45) or Color3.fromRGB(220,220,220)}, 0.12) end)
    btn.MouseLeave:Connect(function() tween(btn, {BackgroundColor3 = primary and Color3.fromRGB(25,25,25) or Color3.fromRGB(240,240,240)}, 0.12) end)
    btn.MouseButton1Click:Connect(function()
        tween(btn, {Size = UDim2.new(1, -24, 0, 40)}, 0.08)
        task.wait(0.08)
        tween(btn, {Size = UDim2.new(1, -20, 0, 42)}, 0.08)
        if callback then pcall(callback) end
    end)

    return btn
end

-- Destroy UI
function DragonHub:Destroy()
    if self.gui and self.gui.Parent then
        self.gui:Destroy()
    end
end

return DragonHub
